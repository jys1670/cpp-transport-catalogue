\hypertarget{transport__router_8h_source}{}\doxysection{transport\+\_\+router.\+h}
\label{transport__router_8h_source}\index{/home/user/Documents/cpp-\/transport-\/catalogue/transport-\/catalogue/transport\_router.h@{/home/user/Documents/cpp-\/transport-\/catalogue/transport-\/catalogue/transport\_router.h}}
\mbox{\hyperlink{transport__router_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{6 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <map>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <unordered\_map>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <utility>}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{domain_8h}{domain.h}}"{}}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{json_8h}{json.h}}"{}}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{router_8h}{router.h}}"{}}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include "{}serialization.h"{}}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{transport__catalogue_8h}{transport\_catalogue.h}}"{}}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{keyword}{namespace }core \{}
\DoxyCodeLine{21 }
\DoxyCodeLine{23 \textcolor{keyword}{class }\mbox{\hyperlink{classcore_1_1TransportRouter}{TransportRouter}} \{}
\DoxyCodeLine{24 \textcolor{keyword}{public}:}
\DoxyCodeLine{25   \textcolor{keyword}{using }\mbox{\hyperlink{structgraph_1_1Edge}{Edge}} = \mbox{\hyperlink{structgraph_1_1Edge}{graph::Edge<double>}};}
\DoxyCodeLine{31   \mbox{\hyperlink{classcore_1_1TransportRouter_a947ffac30720a3df1fa0342b5655ddb7}{TransportRouter}}(\textcolor{keyword}{const} \mbox{\hyperlink{classcore_1_1TransportCatalogue}{TransportCatalogue}} \&catalogue);}
\DoxyCodeLine{32 }
\DoxyCodeLine{33   \textcolor{keywordtype}{void} ImportState(\textcolor{keyword}{const} serialization::TrCatalogue \&sr\_catalogue);}
\DoxyCodeLine{34   \textcolor{keywordtype}{void} ExportState(\mbox{\hyperlink{classserialization_1_1Serializer}{serialization::Serializer}} \&sr);}
\DoxyCodeLine{35 }
\DoxyCodeLine{40   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcore_1_1TransportRouter_a9080ec0fdc6a159049794505cecdf65d}{LoadSettings}}(\textcolor{keyword}{const} \mbox{\hyperlink{classio_1_1json_1_1Node}{io::json::Node}} \&node) \{}
\DoxyCodeLine{41     \textcolor{keyword}{const} \textcolor{keyword}{auto} \&settings = node.AsMap();}
\DoxyCodeLine{42     settings\_.bus\_wait\_time = settings.at(\textcolor{stringliteral}{"{}bus\_wait\_time"{}}).AsDouble();}
\DoxyCodeLine{43     settings\_.bus\_velocity =}
\DoxyCodeLine{44         settings.at(\textcolor{stringliteral}{"{}bus\_velocity"{}}).AsDouble() * 1000.0 / 60.0;}
\DoxyCodeLine{45   \}}
\DoxyCodeLine{46 }
\DoxyCodeLine{53   std::optional<RouteAnswer> \mbox{\hyperlink{classcore_1_1TransportRouter_a81a166ae09aa40fac762324055e2b527}{FindFastestRoute}}(std::string\_view from,}
\DoxyCodeLine{54                                               std::string\_view to);}
\DoxyCodeLine{55 }
\DoxyCodeLine{56 \textcolor{keyword}{private}:}
\DoxyCodeLine{57   \textcolor{keyword}{const} \mbox{\hyperlink{classcore_1_1TransportCatalogue}{TransportCatalogue}} \&catalogue\_;}
\DoxyCodeLine{58   \textcolor{keyword}{struct }\mbox{\hyperlink{structcore_1_1TransportRouter_1_1Settings}{Settings}} \{}
\DoxyCodeLine{59     \textcolor{keywordtype}{double} bus\_wait\_time\{\};}
\DoxyCodeLine{60     \textcolor{keywordtype}{double} bus\_velocity\{\};}
\DoxyCodeLine{61   \} settings\_;}
\DoxyCodeLine{62 }
\DoxyCodeLine{63   \mbox{\hyperlink{classgraph_1_1DirectedWeightedGraph}{graph::DirectedWeightedGraph<double>}} graph\_\{\};}
\DoxyCodeLine{64   \textcolor{keywordtype}{bool} graph\_finished\_\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{65 }
\DoxyCodeLine{66   \textcolor{comment}{// router needs finished graph as constructor, thus pointer is used}}
\DoxyCodeLine{67   std::unique\_ptr<graph::Router<double>> router\_\{\};}
\DoxyCodeLine{68 }
\DoxyCodeLine{69   std::unordered\_map<Vertex, size\_t, VertexHasher> vertex\_to\_id\_\{\};}
\DoxyCodeLine{70   std::vector<Vertex> id\_to\_vertex\_\{\};}
\DoxyCodeLine{71 }
\DoxyCodeLine{72   \textcolor{keywordtype}{void} GenerateGraph();}
\DoxyCodeLine{73 }
\DoxyCodeLine{74   \textcolor{keywordtype}{void} GenerateVertexes(std::vector<const data::Stop *> \&stops);}
\DoxyCodeLine{75 }
\DoxyCodeLine{76   \textcolor{keywordtype}{void} InsertAllEdgesIntoGraph(\textcolor{keyword}{const} data::Bus *bus);}
\DoxyCodeLine{77 }
\DoxyCodeLine{78   \textcolor{keyword}{template} <\textcolor{keyword}{typename} InputIt>}
\DoxyCodeLine{79   \textcolor{keywordtype}{void} InsertEdgesBetweenStops(InputIt begin, InputIt end,}
\DoxyCodeLine{80                                \textcolor{keyword}{const} data::Bus *bus);}
\DoxyCodeLine{81 }
\DoxyCodeLine{82   RouteAnswer GenerateAnswer(\textcolor{keyword}{const} \mbox{\hyperlink{structgraph_1_1Router_1_1RouteInfo}{graph::Router<double>::RouteInfo}} \&path);}
\DoxyCodeLine{83 }
\DoxyCodeLine{84   \textcolor{keywordtype}{void} ImportGraph(\textcolor{keyword}{const} serialization::Graph \&sr\_graph);}
\DoxyCodeLine{85 }
\DoxyCodeLine{86   \textcolor{keywordtype}{void} ImportRouter(\textcolor{keyword}{const} serialization::Router \&sr\_router);}
\DoxyCodeLine{87 }
\DoxyCodeLine{88   \textcolor{keywordtype}{void} ImportVertexIds(\textcolor{keyword}{const} serialization::TrCatalogue \&sr\_catalogue);}
\DoxyCodeLine{89 \};}
\DoxyCodeLine{90 }
\DoxyCodeLine{91 \textcolor{keyword}{template} <\textcolor{keyword}{typename} InputIt>}
\DoxyCodeLine{92 \textcolor{keywordtype}{void} TransportRouter::InsertEdgesBetweenStops(InputIt begin, InputIt end,}
\DoxyCodeLine{93                                               \textcolor{keyword}{const} data::Bus *bus) \{}
\DoxyCodeLine{94   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} it1 = begin; it1 != end; ++it1) \{}
\DoxyCodeLine{95     \textcolor{keywordtype}{double} tot\_dist\{0\};}
\DoxyCodeLine{96     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} it2 = next(it1); it2 != end; ++it2) \{}
\DoxyCodeLine{97       \textcolor{keyword}{auto} norm\_id = vertex\_to\_id\_.at(Vertex().SetStop(*it1).SetWait(\textcolor{keyword}{false}));}
\DoxyCodeLine{98       \textcolor{keyword}{auto} wait\_id = vertex\_to\_id\_.at(Vertex().SetStop(*it2).SetWait(\textcolor{keyword}{true}));}
\DoxyCodeLine{99       \textcolor{keyword}{auto} stops\_between = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(std::distance(it1, it2));}
\DoxyCodeLine{100       \textcolor{keyword}{auto} curr\_dist =}
\DoxyCodeLine{101           catalogue\_.GetStopsRealDist((*prev(it2))-\/>name, (*it2)-\/>name).value();}
\DoxyCodeLine{102       tot\_dist += curr\_dist;}
\DoxyCodeLine{103       graph\_.AddEdge(Edge()}
\DoxyCodeLine{104                          .SetFromVertex(norm\_id)}
\DoxyCodeLine{105                          .SetToVertex(wait\_id)}
\DoxyCodeLine{106                          .SetWeight(tot\_dist / settings\_.bus\_velocity)}
\DoxyCodeLine{107                          .SetBus(bus)}
\DoxyCodeLine{108                          .SetStopCount(stops\_between));}
\DoxyCodeLine{109     \}}
\DoxyCodeLine{110   \}}
\DoxyCodeLine{111 \}}
\DoxyCodeLine{112 }
\DoxyCodeLine{113 \} \textcolor{comment}{// namespace core}}

\end{DoxyCode}
