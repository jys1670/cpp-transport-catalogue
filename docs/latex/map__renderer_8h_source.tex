\hypertarget{map__renderer_8h_source}{}\doxysection{map\+\_\+renderer.\+h}
\label{map__renderer_8h_source}\index{transport-\/catalogue/map\_renderer.h@{transport-\/catalogue/map\_renderer.h}}
\mbox{\hyperlink{map__renderer_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{5 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{6 }
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <cstdlib>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <optional>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <sstream>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{domain_8h}{domain.h}}"{}}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{geo_8h}{geo.h}}"{}}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{json_8h}{json.h}}"{}}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include "{}serialization.h"{}}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{svg_8h}{svg.h}}"{}}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{keyword}{namespace }graphics \{}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{keyword}{inline} \textcolor{keyword}{const} \textcolor{keywordtype}{double} EPSILON = 1e-\/6;}
\DoxyCodeLine{23 \textcolor{keywordtype}{bool} IsZero(\textcolor{keywordtype}{double} value);}
\DoxyCodeLine{24 }
\DoxyCodeLine{26 \textcolor{keyword}{class }\mbox{\hyperlink{classgraphics_1_1SphereProjector}{SphereProjector}} \{}
\DoxyCodeLine{27 \textcolor{keyword}{public}:}
\DoxyCodeLine{38   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Po\textcolor{keywordtype}{int}InputIt>}
\DoxyCodeLine{39   \mbox{\hyperlink{classgraphics_1_1SphereProjector}{SphereProjector}}(PointInputIt points\_begin, PointInputIt points\_end,}
\DoxyCodeLine{40                   \textcolor{keywordtype}{double} max\_width, \textcolor{keywordtype}{double} max\_height, \textcolor{keywordtype}{double} padding);}
\DoxyCodeLine{41 }
\DoxyCodeLine{42   \mbox{\hyperlink{structgraphics_1_1svg_1_1Point}{svg::Point}} operator()(\mbox{\hyperlink{structgeo_1_1Coordinates}{geo::Coordinates}} coords) \textcolor{keyword}{const};}
\DoxyCodeLine{43 }
\DoxyCodeLine{44 \textcolor{keyword}{private}:}
\DoxyCodeLine{45   \textcolor{keywordtype}{double} padding\_;}
\DoxyCodeLine{46   \textcolor{keywordtype}{double} min\_lon\_ = 0;}
\DoxyCodeLine{47   \textcolor{keywordtype}{double} max\_lat\_ = 0;}
\DoxyCodeLine{48   \textcolor{keywordtype}{double} zoom\_coeff\_ = 0;}
\DoxyCodeLine{49 \};}
\DoxyCodeLine{50 }
\DoxyCodeLine{51 \textcolor{keyword}{class }\mbox{\hyperlink{classgraphics_1_1MapRenderer}{MapRenderer}} \{}
\DoxyCodeLine{52 \textcolor{keyword}{public}:}
\DoxyCodeLine{53   \mbox{\hyperlink{classgraphics_1_1MapRenderer}{MapRenderer}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{54 }
\DoxyCodeLine{55   \textcolor{keywordtype}{void} ImportRenderSettings(\textcolor{keyword}{const} serialization::TrCatalogue \&sr\_catalogue);}
\DoxyCodeLine{56   \textcolor{keywordtype}{void} ExportRenderSettings(\mbox{\hyperlink{classserialization_1_1Serializer}{serialization::Serializer}} \&sr);}
\DoxyCodeLine{62   std::string \mbox{\hyperlink{classgraphics_1_1MapRenderer_aff8575d17b1340703094b5bf7b119bfd}{RenderMap}}(\mbox{\hyperlink{structdata_1_1RoutesData}{data::RoutesData}} \mbox{\hyperlink{namespacedata}{data}});}
\DoxyCodeLine{67   \textcolor{keywordtype}{void} \mbox{\hyperlink{classgraphics_1_1MapRenderer_a2aa3c91c8b6d0913eaf06de768cfb2f6}{LoadSettings}}(\textcolor{keyword}{const} \mbox{\hyperlink{classjson_1_1Node}{json::Node}} \&node);}
\DoxyCodeLine{68 }
\DoxyCodeLine{69 \textcolor{keyword}{private}:}
\DoxyCodeLine{71   \mbox{\hyperlink{structinput__info_1_1RenderSettings}{input\_info::RenderSettings}} \mbox{\hyperlink{classgraphics_1_1MapRenderer_aca9c43a4e89c049b55f892d314fd37ea}{settings\_}};}
\DoxyCodeLine{72 }
\DoxyCodeLine{73   \textcolor{keyword}{static} svg::Color ParseColor(\textcolor{keyword}{const} \mbox{\hyperlink{classjson_1_1Node}{json::Node}} \&node);}
\DoxyCodeLine{74 }
\DoxyCodeLine{75   \textcolor{keywordtype}{void} DrawRoutes(\mbox{\hyperlink{structdata_1_1RoutesData}{data::RoutesData}} \&\mbox{\hyperlink{namespacedata}{data}}, \mbox{\hyperlink{classgraphics_1_1SphereProjector}{SphereProjector}} \&projector,}
\DoxyCodeLine{76                   \mbox{\hyperlink{classgraphics_1_1svg_1_1Document}{svg::Document}} \&doc);}
\DoxyCodeLine{77 }
\DoxyCodeLine{78   \textcolor{keywordtype}{void} DrawRouteNames(\mbox{\hyperlink{structdata_1_1RoutesData}{data::RoutesData}} \&\mbox{\hyperlink{namespacedata}{data}}, \mbox{\hyperlink{classgraphics_1_1SphereProjector}{SphereProjector}} \&projector,}
\DoxyCodeLine{79                       \mbox{\hyperlink{classgraphics_1_1svg_1_1Document}{svg::Document}} \&doc);}
\DoxyCodeLine{80 }
\DoxyCodeLine{81   \textcolor{keywordtype}{void} DrawStopSymbols(\mbox{\hyperlink{structdata_1_1RoutesData}{data::RoutesData}} \&\mbox{\hyperlink{namespacedata}{data}}, \mbox{\hyperlink{classgraphics_1_1SphereProjector}{SphereProjector}} \&projector,}
\DoxyCodeLine{82                        \mbox{\hyperlink{classgraphics_1_1svg_1_1Document}{svg::Document}} \&doc);}
\DoxyCodeLine{83 }
\DoxyCodeLine{84   \textcolor{keywordtype}{void} DrawStopNames(\mbox{\hyperlink{structdata_1_1RoutesData}{data::RoutesData}} \&\mbox{\hyperlink{namespacedata}{data}}, \mbox{\hyperlink{classgraphics_1_1SphereProjector}{SphereProjector}} \&projector,}
\DoxyCodeLine{85                      \mbox{\hyperlink{classgraphics_1_1svg_1_1Document}{svg::Document}} \&doc);}
\DoxyCodeLine{86 }
\DoxyCodeLine{87   \textcolor{keyword}{static} svg::Color DeserializeColor(\textcolor{keyword}{const} serialization::Color \&color);}
\DoxyCodeLine{88 \};}
\DoxyCodeLine{89 }
\DoxyCodeLine{90 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Po\textcolor{keywordtype}{int}InputIt>}
\DoxyCodeLine{91 \mbox{\hyperlink{classgraphics_1_1SphereProjector_a3bcf4c098f5aa6718a180eafd0df2614}{SphereProjector::SphereProjector}}(PointInputIt points\_begin,}
\DoxyCodeLine{92                                  PointInputIt points\_end, \textcolor{keywordtype}{double} max\_width,}
\DoxyCodeLine{93                                  \textcolor{keywordtype}{double} max\_height, \textcolor{keywordtype}{double} padding)}
\DoxyCodeLine{94     : padding\_(padding) \{}
\DoxyCodeLine{95 }
\DoxyCodeLine{96   \textcolor{keywordflow}{if} (points\_begin == points\_end) \{}
\DoxyCodeLine{97     \textcolor{keywordflow}{return};}
\DoxyCodeLine{98   \}}
\DoxyCodeLine{99 }
\DoxyCodeLine{100   \textcolor{keyword}{const} \textcolor{keyword}{auto} [left\_it, right\_it] =}
\DoxyCodeLine{101       std::minmax\_element(points\_begin, points\_end,}
\DoxyCodeLine{102                           [](\textcolor{keyword}{auto} lhs, \textcolor{keyword}{auto} rhs) \{ \textcolor{keywordflow}{return} lhs.lng < rhs.lng; \});}
\DoxyCodeLine{103   min\_lon\_ = left\_it-\/>lng;}
\DoxyCodeLine{104   \textcolor{keyword}{const} \textcolor{keywordtype}{double} max\_lon = right\_it-\/>lng;}
\DoxyCodeLine{105 }
\DoxyCodeLine{106   \textcolor{keyword}{const} \textcolor{keyword}{auto} [bottom\_it, top\_it] =}
\DoxyCodeLine{107       std::minmax\_element(points\_begin, points\_end,}
\DoxyCodeLine{108                           [](\textcolor{keyword}{auto} lhs, \textcolor{keyword}{auto} rhs) \{ \textcolor{keywordflow}{return} lhs.lat < rhs.lat; \});}
\DoxyCodeLine{109   \textcolor{keyword}{const} \textcolor{keywordtype}{double} min\_lat = bottom\_it-\/>lat;}
\DoxyCodeLine{110   max\_lat\_ = top\_it-\/>lat;}
\DoxyCodeLine{111 }
\DoxyCodeLine{112   std::optional<double> width\_zoom;}
\DoxyCodeLine{113   \textcolor{keywordflow}{if} (!IsZero(max\_lon -\/ min\_lon\_)) \{}
\DoxyCodeLine{114     width\_zoom = (max\_width -\/ 2 * padding) / (max\_lon -\/ min\_lon\_);}
\DoxyCodeLine{115   \}}
\DoxyCodeLine{116 }
\DoxyCodeLine{117   std::optional<double> height\_zoom;}
\DoxyCodeLine{118   \textcolor{keywordflow}{if} (!IsZero(max\_lat\_ -\/ min\_lat)) \{}
\DoxyCodeLine{119     height\_zoom = (max\_height -\/ 2 * padding) / (max\_lat\_ -\/ min\_lat);}
\DoxyCodeLine{120   \}}
\DoxyCodeLine{121 }
\DoxyCodeLine{122   \textcolor{keywordflow}{if} (width\_zoom \&\& height\_zoom) \{}
\DoxyCodeLine{123     zoom\_coeff\_ = std::min(*width\_zoom, *height\_zoom);}
\DoxyCodeLine{124   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (width\_zoom) \{}
\DoxyCodeLine{125     zoom\_coeff\_ = *width\_zoom;}
\DoxyCodeLine{126   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (height\_zoom) \{}
\DoxyCodeLine{127     zoom\_coeff\_ = *height\_zoom;}
\DoxyCodeLine{128   \}}
\DoxyCodeLine{129 \}}
\DoxyCodeLine{130 }
\DoxyCodeLine{131 \} \textcolor{comment}{// namespace graphics}}

\end{DoxyCode}
